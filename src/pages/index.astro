---
import Layout from '~/layouts/PageLayout.astro';
import Hero from '~/components/widgets/Hero.astro';
import Stats from '~/components/widgets/Stats.astro';
import Brands from '~/components/widgets/Brands.astro';
import Features from '~/components/widgets/Features.astro';
import Grid from '~/components/blog/Grid.astro';
import CallToAction from '~/components/widgets/CallToAction.astro';
import { createReader } from '@keystatic/core/reader';
import keystaticConfig from '../../keystatic.config';
import type { Post } from '~/types';

export const prerender = true;

const reader = createReader(process.cwd(), keystaticConfig);

// Fetch sponsors
const sponsorsEntries = await reader.collections.sponsors.all();
const sponsors = sponsorsEntries
  .sort((a, b) => (a.entry.displayOrder || 0) - (b.entry.displayOrder || 0))
  .map((sponsor) => ({
    src: sponsor.entry.logo || '',
    alt: sponsor.entry.name,
    width: 120,
    height: 48,
  }))
  .filter((sponsor) => sponsor.src); // Filter out sponsors without logos

// Fetch recent events (latest 3)
const eventsEntries = await reader.collections.events.all();
const recentEvents: Post[] = eventsEntries
  .sort((a, b) => new Date(b.entry.eventDate).getTime() - new Date(a.entry.eventDate).getTime())
  .slice(0, 3)
  .map((event) => ({
    id: event.slug,
    slug: event.slug,
    permalink: `/events/${event.slug}`,
    publishDate: new Date(event.entry.eventDate),
    updateDate: new Date(event.entry.eventDate),
    title: event.entry.title,
    excerpt: event.entry.excerpt || '',
    image: event.entry.coverImage || '',
    category: { slug: 'events', title: 'Events' },
    tags: event.entry.galleryTag ? [{ slug: event.entry.galleryTag, title: event.entry.galleryTag }] : [],
    metadata: {},
  }));

const metadata = {
  title: 'CSI - Innowave | Where Innovation Meets Excellence',
  ignoreTitleTemplate: true,
};
---

<Layout metadata={metadata}>
  <!-- Hero Widget ******************* -->

  <Hero
    actions={[
      {
        variant: 'primary',
        text: 'Join Us',
        href: '/contact',
        icon: 'tabler:user-plus',
      },
      { text: 'Learn more', href: '#about' },
    ]}
  >
    <Fragment slot="title">
      <span class="text-accent dark:text-white">&lt; CSI INNOWAVE /&gt;</span>
      <br />
      <span class="text-5xl md:text-6xl">WHERE INNOVATION MEETS EXCELLENCE</span>
    </Fragment>

    <Fragment slot="subtitle">
      <span class="hidden sm:inline">
        <span class="font-semibold">The Computer Society of India</span> at Maharaja Agrasen Institute of Technology
      </span>
      <span class="block mb-1 sm:hidden font-bold text-blue-600">CSI - Innowave</span>
      A premier student technology society fostering innovation, learning, and excellence since 2009. Join us to explore
      cutting-edge technology, attend workshops, and participate in exciting events.
    </Fragment>
  </Hero>

  <!-- Stats Widget ******************* -->

  <Stats
    title="Our Impact in Numbers"
    stats={[
      { title: 'Members', amount: '50+' },
      { title: 'Collaborations', amount: '50+' },
      { title: 'Years of Excellence', amount: '14' },
      { title: 'Event Participants', amount: '1,000+' },
    ]}
  />

  <!-- Brands Widget - Sponsors *************** -->

  <Brands
    title="Trusted By"
    subtitle="Our esteemed partners and sponsors who have supported CSI - Innowave"
    images={sponsors}
    id="sponsors"
  />

  <!-- Features Widget - About Section *************** -->

  <Features
    id="about"
    tagline="About CSI"
    title="The Computer Society of India at MAIT"
    subtitle="A prestigious student society focused on the intersection of technology and society. Established in 2009, we aim to explore advancements and social needs to build a better future."
    items={[
      {
        title: 'Technical Excellence',
        description:
          'Workshops, seminars, and hands-on sessions covering latest technologies, frameworks, and industry best practices.',
        icon: 'tabler:code',
      },
      {
        title: 'Innovation & Creativity',
        description:
          'Hackathons, coding competitions, and project showcases that encourage creative problem-solving and innovation.',
        icon: 'tabler:bulb',
      },
      {
        title: 'Industry Connect',
        description:
          'Guest lectures from industry experts, internship fairs, and networking opportunities with leading companies.',
        icon: 'tabler:briefcase',
      },
      {
        title: 'Team Collaboration',
        description:
          'Build lasting connections through team events, cultural activities, and collaborative projects with fellow members.',
        icon: 'tabler:users',
      },
      {
        title: 'Skill Development',
        description:
          'Comprehensive training programs in web development, AI/ML, cybersecurity, and emerging technologies.',
        icon: 'tabler:chart-line',
      },
      {
        title: 'Community Impact',
        description:
          'Initiatives focused on using technology for social good and contributing to the broader tech community.',
        icon: 'tabler:heart-handshake',
      },
    ]}
  />

  <!-- Recent Events Widget **************** -->

  <section class="px-4 py-16 mx-auto max-w-7xl sm:px-6 lg:px-8">
    <div class="mb-8 text-center">
      <h2 class="text-3xl font-bold tracking-tight sm:text-4xl">Updates & Events</h2>
      <p class="mt-4 text-lg text-gray-600 dark:text-gray-400">
        Explore our recent events, workshops, and activities. Stay updated with the latest happenings in CSI - Innowave.
      </p>
    </div>
    
    {recentEvents.length > 0 ? (
      <Grid posts={recentEvents} />
      <div class="mt-8 text-center">
        <a
          href="/events"
          class="inline-flex items-center gap-2 text-primary hover:underline font-semibold"
        >
          View all events
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
          </svg>
        </a>
      </div>
    ) : (
      <div class="text-center py-12">
        <p class="text-gray-600 dark:text-gray-400">
          No events available yet. Check back soon!
        </p>
      </div>
    )}
  </section>

  <!-- Features Widget - Highlights *************** -->

  <Features
    title="Highlights"
    subtitle="Memorable moments and achievements from CSI - Innowave"
    columns={3}
    items={[
      {
        title: 'Digital Revolution',
        description:
          'VR gaming stall showcased our tech enthusiasm in Innovation Mela and various events.',
        icon: 'tabler:device-gamepad',
      },
      {
        title: 'The Spirit of Adventure',
        description:
          'Our Society proudly embraces the digital revolution by hosting cutting-edge tech experiences.',
        icon: 'tabler:rocket',
      },
      {
        title: 'The Joy of Creation',
        description:
          'Our entire team came together to uplift events and create joyous memories!',
        icon: 'tabler:sparkles',
      },
      {
        title: 'Power of Communication',
        description: 'Communication and planning are crucial for any successful event.',
        icon: 'tabler:message-circle',
      },
      {
        title: 'The Art of Design',
        description:
          'Our team brings creativity to every event, leaving a lasting mark on all attendees.',
        icon: 'tabler:palette',
      },
      {
        title: 'Team Collaboration',
        description:
          'The people who became family, always there through our highs and lows.',
        icon: 'tabler:heart',
      },
    ]}
  />

  <!-- CallToAction Widget *********** -->

  <CallToAction
    title="Ready to join CSI - Innowave?"
    subtitle="Be part of a vibrant community of tech enthusiasts, innovators, and future leaders."
    actions={[
      {
        variant: 'primary',
        text: 'Contact Us',
        href: '/contact',
      },
      {
        variant: 'secondary',
        text: 'View Team',
        href: '/team',
      },
    ]}
  />
</Layout>
